# Isolate this stack from others; use with docker compose up/down
COMPOSE_PROJECT_NAME=olo
CASSANDRA_VERSION=3.11.9
ELASTICSEARCH_VERSION=8.17.3
MYSQL_VERSION=9.2.0
TEMPORAL_VERSION=1.27.0
TEMPORAL_ADMINTOOLS_VERSION=1.27.0
TEMPORAL_UI_VERSION=2.34.0
POSTGRESQL_VERSION=16
POSTGRES_PASSWORD=pgpass
POSTGRES_USER=temporal
POSTGRES_DEFAULT_PORT=5432
OPENSEARCH_VERSION=2.5.0
QDRANT_VERSION=v1.12.0
REDIS_VERSION=7-alpine
REDIS_INSIGHT_VERSION=latest
# Worker image tag (default: latest)
# WORKER_IMAGE_TAG=latest
# Host directory mounted at /app/shared in worker (default: ./shared)
# WORKER_SHARED_VOLUME=./shared

# ---------------------------------------------------------------------------
# Open LLM Orchestrator Worker – environment variables (docker-compose stack)
# In stack, hostnames are service names: temporal, redis, ollama, olo-postgres.
# ---------------------------------------------------------------------------
TEMPORAL_TARGET=temporal:7233
TEMPORAL_NAMESPACE=default
QUEUE_NAME=core-task-queue
CONFIG_KEY=default
CONFIG_VERSION=1.0
CONFIG_RETRY_SLEEP_SECONDS=30
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
# Worker config DB: create database olo_config on postgres (see scripts/create-olo-config-db.bat)
WORKER_DB_URL=jdbc:postgresql://olo-postgres:5432/olo_config
WORKER_DB_USERNAME=temporal
WORKER_DB_PASSWORD=pgpass
MAX_CONCURRENT_WORKFLOW_TASK_POLLERS=5
MAX_CONCURRENT_ACTIVITY_TASK_POLLERS=10
OLLAMA_BASE_URL=http://ollama:11434
OLLAMA_MODEL=llama3.2:latest
OLLAMA_TIMEOUT_SECONDS=300

# Server (UI API) — backend runs on this port (8002 chosen to avoid conflict with Docker on 8000/8001).
PORT_BACKEND=8002
PORT_UI=5173

# Frontend: set in .env so Vite exposes it. If set, the app calls the backend at this URL
# (e.g. http://localhost:8002) instead of using the proxy. Run backend first, then npm run dev:client.
# VITE_API_URL=http://localhost:8002

# Temporal server (gRPC); task queue must match Worker QUEUE_NAME (e.g. core-task-queue)
TEMPORAL_ADDRESS=temporal:7233
TEMPORAL_NAMESPACE=default
TEMPORAL_TASK_QUEUE=core-task-queue

# Set to 1 for stub LLM replies when Temporal is unavailable
USE_STUB_LLM=0

# Chat tab pipelines. Format: id:Label,id2:Label2 (comma-separated). Unset/empty = use built-in defaults.
PIPELINE_OPTIONS=llama-oss:Llama OSS,openai-oss:OpenAI OSS,both:Both models,chat-mistral:Mistral,chat-llama3.2:Llama 3.2,chat-phi3:Phi-3,chat-gemma2-2b:Gemma 2 2B,chat-qwen2-1.5b:Qwen2 1.5B,query-all-models:Query all models
# RAG tab pipelines. Format: id:Label,id2:Label2 (comma-separated). Unset/empty = use built-in defaults.
PIPELINE_OPTIONS_RAG=question-answer:Question-Answer (RAG),rag-llama-oss:RAG Llama OSS,rag-openai-oss:RAG OpenAI OSS,rag-both:RAG Both models,rag-mistral:RAG Mistral,rag-llama3.2:RAG Llama 3.2,rag-phi3:RAG Phi-3,rag-gemma2-2b:RAG Gemma 2 2B,rag-qwen2-1.5b:RAG Qwen2 1.5B

# Mounted folder for payload templates: <pipeline>_<kind>.tpl (e.g. llama-oss_chat.tpl)
TEMPLATES_DIR=/mnt/templates

# Chat: workflow started only when user sends a message (payload from template, wait for response)
# Must match Worker's registered workflow type (e.g. CoreWorkflow)
TEMPORAL_CHAT_WORKFLOW=CoreWorkflow
TEMPORAL_WORKFLOW_ID_TEMPLATE=chat-{{pipelineId}}-{{timestamp}}
TEMPORAL_WORKFLOW_CLASS=core-task-queue
# Max ms to wait for workflow result (default 120000). If no Worker runs the workflow, API returns this error.
# TEMPORAL_CHAT_RESULT_TIMEOUT_MS=120000

# RAG upload (doc ingestion) workflow — name, ID template, task queue (same core workflow)
# TEMPORAL_DOC_WORKFLOW=CoreWorkflow
# TEMPORAL_DOC_WORKFLOW_ID_TEMPLATE=doc-ingest-{{ragTag}}-{{timestamp}}
# TEMPORAL_DOC_TASK_QUEUE=core-task-queue

# Optional: persist conversations/messages to file when Redis is not used (e.g. data/store.json)
# STORE_FILE=data/store.json

# Redis for UI store: two buckets olo-ui:chat (Chat tab) and olo-ui:rag (RAG tab).
# If set, file store is ignored; delete conversation removes from Redis as well.
REDIS_URL=redis://redis:6379
# Or:
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=

# -----------------------------------------------------------------------------
# Open LLM Orchestrator - Configuration UI
# Copy to .env and adjust. Used by docker-compose and local runs.
# -----------------------------------------------------------------------------

# ---- Server & Ports ----
SERVER_PORT=8082
# FRONTEND_PORT=5173  # Only for separate frontend dev server; single container serves UI on SERVER_PORT
# Set to 0.0.0.0 in Docker so the backend is reachable from host (docker-compose sets this)
SERVER_ADDRESS=

# ---- Redis (used by backend for saved configs and engine config storage) ----
SPRING_DATA_REDIS_HOST=redis
SPRING_DATA_REDIS_PORT=6379
SPRING_DATA_REDIS_PASSWORD=
SPRING_DATA_REDIS_TIMEOUT=2000ms

# ---- OLO Redis key prefixes ----
OLO_REDIS_ENABLED=true
OLO_REDIS_CONFIG_KEY_PREFIX=olo:config:
OLO_REDIS_ENGINE_CONFIG_KEY_PREFIX=olo:engine:config:

# ---- Paths (templates, components, plugins; in container use /app paths) ----
# Local dev: relative to backend/ (e.g. ../template). Docker: mount volumes or set to /app/template etc.
OLO_TEMPLATES_DIR=/app/template
OLO_COMPONENTS_DIR=/app/components
OLO_PLUGINS_DIR=/app/components/plugins
OLO_PLUGIN_SCHEMAS_PATH=classpath:plugin-schemas/

# ---- PostgreSQL ----
# Backend on host (mvn spring-boot:run): use localhost and your Postgres user/db/password.
# Example when Postgres is in Docker (e.g. olo-postgres) with user temporal, password pgpass, db temporal:
SPRING_DATASOURCE_URL=jdbc:postgresql://olo-postgres:5432/temporal
SPRING_DATASOURCE_DRIVER=org.postgresql.Driver
SPRING_DATASOURCE_USERNAME=temporal
SPRING_DATASOURCE_PASSWORD=pgpass

# When backend runs inside Docker Compose: use service name as host (postgres or olo-postgres).
# Compose builds URL from POSTGRES_*; override if your Postgres container uses different credentials.
POSTGRES_HOST=olo-postgres
POSTGRES_PORT=5432
POSTGRES_DB=temporal
POSTGRES_USER=temporal
POSTGRES_PASSWORD=pgpass

# ---- Optional Spring / JPA ----
SPRING_APPLICATION_NAME=olo-config-backend
SPRING_H2_CONSOLE_ENABLED=false
SPRING_JPA_HIBERNATE_DDL_AUTO=update
SPRING_JPA_SHOW_SQL=false
SPRING_JPA_DATABASE_PLATFORM=org.hibernate.dialect.PostgreSQLDialect